<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Code 9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Motion Background */
        body {
            background: linear-gradient(45deg, #1e3a8a, #3b82f6, #f97316, #ef4444);
            background-size: 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Card Hover Effect */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Smooth Scroll */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="font-poppins">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-blue-700">Code 9</span>
                </div>
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="text-gray-700 hover:text-orange-500 transition-colors">Home</a>
                    <a href="careers.html" class="text-gray-700 hover:text-orange-500 transition-colors">Careers</a>
                    <a href="blog.html" class="text-gray-700 hover:text-orange-500 transition-colors">Blog</a>
                    <a href="login.html" id="logout" class="text-gray-700 hover:text-orange-500 transition-colors">Logout</a>
                    <div class="relative">
                        <button id="profileBtn" class="flex items-center space-x-2 text-gray-700 hover:text-orange-500">
                            <i class="fas fa-user-circle text-2xl"></i>
                            <span id="profileName">Profile</span>
                        </button>
                        <!-- Dropdown Menu -->
                        <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-2 z-50">
                            <a href="#profile" class="block px-4 py-2 text-gray-700 hover:bg-orange-100">View Profile</a>
                            <a href="#settings" class="block px-4 py-2 text-gray-700 hover:bg-orange-100">Settings</a>
                            <a href="#logout" class="block px-4 py-2 text-gray-700 hover:bg-orange-100">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-4xl font-extrabold text-white">Your Dashboard</h2>
                <p class="mt-2 text-gray-200">Manage your job requests, track progress, and stay productive.</p>
            </div>
            <div class="flex items-center space-x-4">
                <button id="darkModeToggle" class="p-2 rounded-full bg-gray-200 hover:bg-gray-300">
                    <i class="fas fa-moon text-gray-700"></i>
                </button>
                <button id="notificationsBtn" class="relative p-2 rounded-full bg-gray-200 hover:bg-gray-300">
                    <i class="fas fa-bell text-gray-700"></i>
                    <span id="notificationBadge" class="absolute top-0 right-0 h-2 w-2 bg-red-500 rounded-full"></span>
                </button>
            </div>
        </div>

        <!-- Grid Layout -->
        <div class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- User Profile Card -->
            <div class="card bg-white rounded-lg shadow-xl p-6 col-span-1">
                <h3 class="text-xl font-bold text-blue-800">Your Profile</h3>
                <div class="mt-4 flex items-center space-x-4">
                    <img id="profileImage" src="https://via.placeholder.com/64" alt="Profile" class="h-16 w-16 rounded-full">
                    <div>
                        <p id="userName" class="text-gray-700 font-medium">John Doe</p>
                        <p id="userRole" class="text-gray-500 text-sm">Software Developer</p>
                        <p id="userEmail" class="text-gray-500 text-sm">john.doe@example.com</p>
                    </div>
                </div>
                <button class="mt-4 w-full py-2 px-4 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors">
                    Edit Profile
                </button>
            </div>

            <!-- Streak Calendar -->
            <div class="card bg-white rounded-lg shadow-xl p-6 col-span-2">
                <h3 class="text-xl font-bold text-blue-800">Your Job Request Streak</h3>
                <div id="streakCalendar" class="mt-4 grid grid-cols-7 gap-2"></div>
                <p class="mt-4 text-gray-600">Current Streak: <span id="streakCount" class="font-bold">0</span> job requests</p>
                <canvas id="streakChart" class="mt-4"></canvas>
            </div>

            <!-- Job Request Form -->
            <div class="card bg-blue-50 rounded-lg shadow-xl p-6 col-span-1">
                <h3 class="text-xl font-bold text-blue-800">Request a New Job</h3>
                <form id="jobRequestForm" class="mt-4 space-y-4">
                    <div>
                        <label for="jobTitle" class="block text-sm font-medium text-gray-700">Job Title</label>
                        <input id="jobTitle" type="text" required class="mt-1 w-full px-4 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="jobCategory" class="block text-sm font-medium text-gray-700">Category</label>
                        <select id="jobCategory" class="mt-1 w-full px-4 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500">
                            <option value="frontend">Frontend</option>
                            <option value="backend">Backend</option>
                            <option value="fullstack">Fullstack</option>
                            <option value="design">Design</option>
                        </select>
                    </div>
                    <div>
                        <label for="jobDescription" class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea id="jobDescription" rows="4" class="mt-1 w-full px-4 py-2 border rounded-md focus:ring-orange-500 focus:border-orange-500"></textarea>
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 transition-colors">
                            Submit Job Request <i class="fas fa-plus ml-2"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recent Job Requests -->
            <div class="card bg-white rounded-lg shadow-xl p-6 col-span-2">
                <h3 class="text-xl font-bold text-blue-800">Recent Job Requests</h3>
                <div class="mt-4 flex space-x-4">
                    <button class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600" onclick="filterJobs('all')">All</button>
                    <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300" onclick="filterJobs('pending')">Pending</button>
                    <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300" onclick="filterJobs('completed')">Completed</button>
                </div>
                <ul id="jobRequestsList" class="mt-4 space-y-4"></ul>
            </div>

            <!-- Job Statistics -->
            <div class="card bg-white rounded-lg shadow-xl p-6 col-span-3">
                <h3 class="text-xl font-bold text-blue-800">Job Statistics</h3>
                <canvas id="jobStatsChart" class="mt-4"></canvas>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div id="notificationsPanel" class="hidden fixed top-0 right-0 h-full w-80 bg-white shadow-xl p-6 z-50">
        <h3 class="text-xl font-bold text-blue-800">Notifications</h3>
        <ul id="notificationsList" class="mt-4 space-y-2"></ul>
    </div>

    <script>
        // Initialize Socket.IO
        const socket = io();

        // Load User Profile from Local Storage
        function loadUserProfile() {
            const userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
                name: 'John Doe',
                role: 'Software Developer',
                email: 'john.doe@example.com',
                profileImage: 'https://via.placeholder.com/64'
            };
            document.getElementById('userName').textContent = userProfile.name;
            document.getElementById('userRole').textContent = userProfile.role;
            document.getElementById('userEmail').textContent = userProfile.email;
            document.getElementById('profileImage').src = userProfile.profileImage;
            document.getElementById('profileName').textContent = userProfile.name.split(' ')[0]; // First name for profile button
        }

        // GSAP Animations
        gsap.from(".card", { duration: 0.8, y: 50, opacity: 0, stagger: 0.2, ease: "power3.out" });

        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const icon = darkModeToggle.querySelector('i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        });

        // Profile Dropdown
        const profileBtn = document.getElementById('profileBtn');
        const profileDropdown = document.getElementById('profileDropdown');
        profileBtn.addEventListener('click', () => {
            profileDropdown.classList.toggle('hidden');
        });

        // Notifications Panel
        const notificationsBtn = document.getElementById('notificationsBtn');
        const notificationsPanel = document.getElementById('notificationsPanel');
        notificationsBtn.addEventListener('click', () => {
            notificationsPanel.classList.toggle('hidden');
            gsap.fromTo(notificationsPanel, { x: 300, opacity: 0 }, { x: 0, opacity: 1, duration: 0.5 });
        });

        // Handle Job Request Form Submission
        const jobRequestForm = document.getElementById('jobRequestForm');
        jobRequestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const jobData = {
                title: document.getElementById('jobTitle').value,
                category: document.getElementById('jobCategory').value,
                description: document.getElementById('jobDescription').value,
                timestamp: new Date().toISOString()
            };
            socket.emit('newJobRequest', jobData);
            jobRequestForm.reset();
        });

        // Real-Time Job Requests
        socket.on('jobRequestsUpdate', (jobs) => {
            const jobList = document.getElementById('jobRequestsList');
            jobList.innerHTML = '';
            jobs.forEach(job => {
                const li = document.createElement('li');
                li.className = 'p-2 bg-gray-100 rounded-md';
                li.innerHTML = `
                    <p class="font-medium">${job.title}</p>
                    <p class="text-sm text-gray-600">${job.category} - ${job.status}</p>
                    <p class="text-sm text-gray-500">${new Date(job.timestamp).toLocaleString()}</p>
                `;
                jobList.appendChild(li);
            });
        });

        // Real-Time Notifications
        socket.on('newNotification', (notification) => {
            const notificationsList = document.getElementById('notificationsList');
            const li = document.createElement('li');
            li.className = 'p-2 bg-gray-100 rounded-md';
            li.textContent = notification.message;
            notificationsList.prepend(li);
            document.getElementById('notificationBadge').style.display = 'block';
        });

        // Streak Calendar
        function updateStreakCalendar(streaks) {
            const streakCalendar = document.getElementById('streakCalendar');
            streakCalendar.innerHTML = '';
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const div = document.createElement('div');
                div.className = 'text-center text-gray-600';
                div.textContent = day;
                streakCalendar.appendChild(div);
            });
            for (let i = 1; i <= 30; i++) {
                const div = document.createElement('div');
                div.className = `text-center p-2 rounded-full ${streaks.includes(i) ? 'bg-orange-500 text-white' : 'bg-gray-200'}`;
                div.textContent = i;
                streakCalendar.appendChild(div);
            }
        }

        // Real-Time Streak Updates
        socket.on('streakUpdate', (data) => {
            document.getElementById('streakCount').textContent = data.streakCount;
            updateStreakCalendar(data.streakDays);
            streakChart.data.labels = data.months;
            streakChart.data.datasets[0].data = data.jobCounts;
            streakChart.update();
        });

        // Chart.js for Streak Chart
        const streakChart = new Chart(document.getElementById('streakChart'), {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Job Requests',
                    data: [0, 0, 0, 0, 0, 0],
                    borderColor: '#f97316',
                    fill: false,
                }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        // Chart.js for Job Stats
        const jobStatsChart = new Chart(document.getElementById('jobStatsChart'), {
            type: 'bar',
            data: {
                labels: ['Pending', 'In Progress', 'Completed'],
                datasets: [{
                    label: 'Job Status',
                    data: [0, 0, 0],
                    backgroundColor: ['#f97316', '#3b82f6', '#10b981']
                }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        // Real-Time Job Stats
        socket.on('jobStatsUpdate', (stats) => {
            jobStatsChart.data.datasets[0].data = [
                stats.pending,
                stats.inProgress,
                stats.completed
            ];
            jobStatsChart.update();
        });

        // Filter Jobs
        function filterJobs(status) {
            const buttons = document.querySelectorAll('.card button');
            buttons.forEach(btn => {
                btn.classList.replace('bg-orange-500', 'bg-gray-200');
                btn.classList.replace('text-white', 'text-gray-700');
            });
            event.target.classList.add('bg-orange-500', 'text-white');
            socket.emit('filterJobs', status);
        }

        // Logout Functionality
        document.getElementById('logout').addEventListener('click', () => {
            localStorage.removeItem('userProfile');
            window.location.href = 'login.html'; // Redirect to login page
        });

        // Initialize Dashboard
        window.addEventListener('load', () => {
            loadUserProfile();
            socket.emit('getInitialData'); // Request initial data from server
        });
    </script>
</body>
</html>